# 연도 자동화 및 그래프 개선 가이드

## 📅 1. 연도 자동화 (완료된 부분)

### ✅ 이미 적용된 변경사항:

1. **자동 연도 설정 추가** (32-42라인)
   - `current_year`: 현재 연도 (2026)
   - `previous_year_1`: 전년도 (2025)
   - `previous_year_2`: 전전년도 (2024)
   - 각 연도의 문자열 버전 (`current_year_str` 등)

2. **목표값 변수명 변경** (46-68라인)
   - `_2025년` → `_목표`로 변경
   - 예: `수입검사_불량수량_2025년` → `수입검사_불량수량_목표`
   
3. **데이터 필터링 변수명 변경** (78-147라인)
   - `_2023` → `_prev2`
   - `_2024` → `_prev1`
   - `_2025` → `_current`
   - 하드코딩된 연도 문자열을 변수로 교체

---

## 🔧 2. 추가 수정이 필요한 부분

파일이 3900+ 라인으로 매우 크기 때문에, 아래 패턴을 참고하여 나머지 부분을 수정해야 합니다:

### 📋 수정 패턴:

#### A. 데이터 필터링 ( query 문)
```python
# 수정 전:
검사수량_1월 = 수입검사현황.query("일자.str.contains('2025.01.')")

# 수정 후:
검사수량_1월 = 수입검사현황.query(f"일자.str.contains('{current_year}.01.')")
```

#### B. 변수명
```python
# 수정 전:
수입검사부적합합계_2023
수입검사부적합합계_2024
수입검사부적합합계_2025

# 수정 후:
수입검사부적합합계_prev2
수입검사부적합합계_prev1
수입검사부적합합계_current
```

#### C. 그래프 X축 레이블
```python
# 수정 전:
x = ['23년', '24년', '25년']

# 수정 후:
x = [f'{previous_year_2 % 100}년', f'{previous_year_1 % 100}년', f'{current_year % 100}년']
# 또는
x = [f'{previous_year_2}년', f'{previous_year_1}년', f'{current_year}년']
```

### 📝 수정이 필요한 주요 섹션:

1. **월별 데이터 집계** (245-586라인)
   - 모든 `.query("일자.str.contains('2025.XX.')")` 패턴

2. **고객사라인부적합** (157-173라인)
   
3. **필드클레임현황** (176-206라인)

4. **QCOST현황** (208-242라인)

5. **곤산 데이터** (588-771라인)

6. **모든 그래프 코드** (1600-3900라인)
   - X축 레이블
   - 데이터 변수명

---

## 🎨 3. 그래프 시각화 개선

### 개선 포인트:

#### A. 색상 팔레트 개선
```python
# 수정 전:
colors = list(range(5))

# 수정 후 (현대적인 그라데이션 색상):
colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#00f2fe']
# 또는 viridis 팔레트:
import plotly.express as px
colors = px.colors.sequential.Viridis
```

#### B. 마커 스타일 향상
```python
# 개선된 scatter trace:
fig.add_trace(go.Scatter(
    x=x, y=y_data,
    mode='lines+markers',
    marker=dict(
        size=12,
        color='#ff6b6b',
        symbol='circle',
        line=dict(color='white', width=2)  # 테두리 추가
    ),
    line=dict(
        color='#ff6b6b',
        width=3,
        shape='spline'  # 부드러운 곡선
    )
))
```

#### C. 레이아웃 개선
```python
fig.update_layout(
    title=dict(
        text="♊수입검사 년도별 현황",
        font=dict(size=20, color='#ffffff', family='Arial Black')
    ),
    plot_bgcolor='rgba(0,0,0,0)',  # 투명 배경
    paper_bgcolor='rgba(17, 17, 17, 0.8)',  # 어두운 배경
    font=dict(color='#ffffff', size=12),
    hovermode='x unified',  # 통합 호버
    hoverlabel=dict(
        bgcolor="rgba(255,255,255,0.8)",
        font_size=14,
        font_family="Arial"
    )
)
```

#### D. 애니메이션 추가
```python
# 그래프 생성 시:
fig = go.Figure()
fig.update_layout(
    transition_duration=500  # 부드러운 전환
)
```

#### E. 그리드 스타일 개선
```python
fig.update_xaxes(
    showgrid=True,
    gridwidth=1,
    gridcolor='rgba(128, 128, 128, 0.2)',
    showline=True,
    linewidth=2,
    linecolor='rgba(128, 128, 128, 0.3)'
)

fig.update_yaxes(
    showgrid=True,
    gridwidth=1,
    gridcolor='rgba(128, 128, 128, 0.2)'
)
```

---

## 🚀 4. 적용 방법

### 옵션 1: 수동 수정 (권장)
파일을 열고 위의 패턴을 참고하여 섹션별로 수정

### 옵션 2: 찾기/바꾸기
- VS Code 또는 텍스트 에디터의 정규식 찾기/바꾸기 기능 사용
- 주의: 백업 필수!

### 옵션 3: 일괄 변환 스크립트
별도의 Python 스크립트를 작성하여 자동 변환 (매우 큰 파일이므로 위험)

---

## ⚠️ 주의사항

1. **백업**: 수정 전 반드시 파일 백업
2. **테스트**: 각 섹션 수정 후 앱 실행하여 오류 확인
3. **데이터베이스**: 데이터베이스 테이블명은 수정하지 않음
4. **목표값**: 목표값 변수는 매년 수동으로 수정 필요

---

## 📊 5. 예상 효과

### 연도 자동화:
- ✅ 매년 자동으로 현재 연도 데이터 표시
- ✅ 수동 수정 필요 없음
- ✅ 유지보수 용이

### 그래프 개선:
- ✅ 시각적으로 더 세련된 디자인
- ✅ 가독성 향상
- ✅ 사용자 경험 개선

---

## 💡 다음 단계

1. 이 가이드를 참고하여 나머지 섹션 수정
2. 그래프 스타일 적용
3. 앱 실행하여 테스트
4. 필요시 추가 조정

---

생성일: 2026-01-02
작성자: Antigravity AI
